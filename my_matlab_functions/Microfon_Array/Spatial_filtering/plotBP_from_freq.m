function [] = plotBP_from_freq(W, Nel, J, tetaSign, tetaNois)
c = 343;
f_required = 2000;
lambda = c/f_required;
d = lambda/2;
fs = 8e3;

num_bin = 1000*2;
wfreq = fft(reshape(W,Nel,J).',num_bin);                    % из импульсной характеристики каналов получаем частотную
freqvec = [0:num_bin/2 -num_bin/2+1:-1]*fs/num_bin;         % частоты, которые соответствуют отсчетам частотной характеристики wfreq
% freqbin = 250:250:4000;                                     % частоты, для которых строю ДН
NN = 1000;
freqbin = freqvec(1:length(freqvec)/2/NN:length(freqvec)/2-length(freqvec)/2/10);          % частоты, для которых строю ДН
phi = -90:0.5:90-0.5;

BP = zeros(length(freqbin),length(phi));

for kk = 1:length(freqbin)
    bandidx = find( freqvec==freqbin(kk)) ;                 % индекс freqvec, который соответ частоте freqbin(kk)

    %steervec((n-1)*d/lambda, 10)'  =  exp(-1i*2*pi  /lambda*(n-1)*d  *sind(10) )
    lambda = c/freqbin(kk);

    P = zeros(1,length(phi));

    for ii=1:length(phi)
        stv = steervec(( (1:Nel) -1)*d/lambda,phi(ii))';                  
        P(ii) =  stv* (   wfreq(bandidx,:).'   );                
    end
    BP(kk,:) = abs(P).^2;
end

BP_dB = 10*log10(BP);

BP_dB(BP_dB<-40) = -40;
%%
figure1 = figure();
axes1 = axes('Parent',figure1);
grid on;
hold on;
% plot(phi,Fn_dB);
plot(phi,BP_dB,'LineWidth',0.25,'Color',[0.501960813999176 0.501960813999176 0.501960813999176]); 
yyy = ylim;
line([tetaSign tetaSign], yyy,'LineWidth',1,'Color','k')
line([tetaNois tetaNois], yyy,'LineWidth',1,'Color','k')
ylabel('BP, дБ')
xlabel('Угол прихода, град')
xlim([-90 90])
% legend('Fn dB','Fc dB');
set(axes1,'FontSize',14);
 %%
[PHI,FRREQ] = meshgrid(phi,freqbin);

% figure1 = figure('Colormap',...
%     [0 0 0;0.00580720091238618 0.00580720091238618 0.00580720091238618;0.0116144018247724 0.0116144018247724 0.0116144018247724;0.0174216032028198 0.0174216032028198 0.0174216032028198;0.0232288036495447 0.0232288036495447 0.0232288036495447;0.0290360040962696 0.0290360040962696 0.0290360040962696;0.0348432064056396 0.0348432064056396 0.0348432064056396;0.0406504049897194 0.0406504049897194 0.0406504049897194;0.0464576072990894 0.0464576072990894 0.0464576072990894;0.0522648096084595 0.0522648096084595 0.0522648096084595;0.0580720081925392 0.0580720081925392 0.0580720081925392;0.063879206776619 0.063879206776619 0.063879206776619;0.0696864128112793 0.0696864128112793 0.0696864128112793;0.075493611395359 0.075493611395359 0.075493611395359;0.0813008099794388 0.0813008099794388 0.0813008099794388;0.0871080160140991 0.0871080160140991 0.0871080160140991;0.0929152145981789 0.0929152145981789 0.0929152145981789;0.0987224131822586 0.0987224131822586 0.0987224131822586;0.104529619216919 0.104529619216919 0.104529619216919;0.110336817800999 0.110336817800999 0.110336817800999;0.116144016385078 0.116144016385078 0.116144016385078;0.121951222419739 0.121951222419739 0.121951222419739;0.127758413553238 0.127758413553238 0.127758413553238;0.133565619587898 0.133565619587898 0.133565619587898;0.139372825622559 0.139372825622559 0.139372825622559;0.145180016756058 0.145180016756058 0.145180016756058;0.150987222790718 0.150987222790718 0.150987222790718;0.156794428825378 0.156794428825378 0.156794428825378;0.162601619958878 0.162601619958878 0.162601619958878;0.168408825993538 0.168408825993538 0.168408825993538;0.174216032028198 0.174216032028198 0.174216032028198;0.180023223161697 0.180023223161697 0.180023223161697;0.185830429196358 0.185830429196358 0.185830429196358;0.191637635231018 0.191637635231018 0.191637635231018;0.197444826364517 0.197444826364517 0.197444826364517;0.203252032399178 0.203252032399178 0.203252032399178;0.209059238433838 0.209059238433838 0.209059238433838;0.214866429567337 0.214866429567337 0.214866429567337;0.220673635601997 0.220673635601997 0.220673635601997;0.226480841636658 0.226480841636658 0.226480841636658;0.232288032770157 0.232288032770157 0.232288032770157;0.238095238804817 0.238095238804817 0.238095238804817;0.266817837953568 0.266817837953568 0.266817837953568;0.295540452003479 0.295540452003479 0.295540452003479;0.324263036251068 0.324263036251068 0.324263036251068;0.35298565030098 0.35298565030098 0.35298565030098;0.381708234548569 0.381708234548569 0.381708234548569;0.41043084859848 0.41043084859848 0.41043084859848;0.439153432846069 0.439153432846069 0.439153432846069;0.467876046895981 0.467876046895981 0.467876046895981;0.49659863114357 0.49659863114357 0.49659863114357;0.525321245193481 0.525321245193481 0.525321245193481;0.554043829441071 0.554043829441071 0.554043829441071;0.582766473293304 0.582766473293304 0.582766473293304;0.611489057540894 0.611489057540894 0.611489057540894;0.640211641788483 0.640211641788483 0.640211641788483;0.668934226036072 0.668934226036072 0.668934226036072;0.697656869888306 0.697656869888306 0.697656869888306;0.726379454135895 0.726379454135895 0.726379454135895;0.755102038383484 0.755102038383484 0.755102038383484;0.783824622631073 0.783824622631073 0.783824622631073;0.812547266483307 0.812547266483307 0.812547266483307;0.841269850730896 0.841269850730896 0.841269850730896;0.87058824300766 0.87058824300766 0.87058824300766]);
figure1 = figure();
colormap(gray);
% Create axes
axes1 = axes('Parent',figure1);
hold(axes1,'on');

% Create surf
surf(PHI,FRREQ,BP_dB,'Parent',axes1,'LineStyle','none'); 
% Create ylabel
ylabel('Частота, Гц','Rotation',-80)
xlabel('Угол прихода, град')
zlabel('BP, дБ')
xlim([-90 90])
ylim([1 3800])
view(axes1,[174.34 62]);
grid(axes1,'on');
% Set the remaining axes properties
set(axes1,'FontSize',14);
% zlim([-40 5])

end

